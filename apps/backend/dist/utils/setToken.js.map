{"version":3,"sources":["../../src/utils/setToken.ts"],"sourcesContent":["import { UserFullType, UserType } from \"@typedefs/Prisma\";\r\nimport cookie from \"cookie\";\r\nimport { Response } from \"express\";\r\nimport jwt from \"jsonwebtoken\";\r\n\r\nexport interface JWTPayload {\r\n  id: string;\r\n  email: string | null;\r\n  firstName?: string | null;\r\n  lastName?: string | null;\r\n  accessTokenExpires: number;\r\n}\r\n\r\nexport const setToken = (user: UserType, res: Response): void => {\r\n  const payload: JWTPayload = {\r\n    email: user.email,\r\n    id: user.id,\r\n    firstName: user.firstName,\r\n    lastName: user.lastName,\r\n    accessTokenExpires:\r\n      Date.now() + parseInt(process.env.TOKEN_REFRESH_PERIOD) * 1000,\r\n  };\r\n\r\n  const token = jwt.sign(payload, process.env.JWT_SECRET_KEY);\r\n\r\n  console.log(\"token: \", token);\r\n\r\n  res.cookie(\"rid\", token, {\r\n    httpOnly: true,\r\n  });\r\n};\r\n\r\nexport const createToken = (user: UserType): string => {\r\n  const payload: JWTPayload = {\r\n    email: user.email,\r\n    firstName: user.firstName,\r\n    lastName: user.lastName,\r\n    id: user.id,\r\n    accessTokenExpires:\r\n      Date.now() + parseInt(process.env.TOKEN_REFRESH_PERIOD) * 1000,\r\n  };\r\n  // return jwt\r\n  const token = jwt.sign(payload, process.env.JWT_SECRET_KEY);\r\n\r\n  return token;\r\n};\r\n\r\nexport const createRefreshToken = (user: UserType) => {\r\n  const payload: JWTPayload = {\r\n    email: user.email,\r\n    firstName: user.firstName,\r\n    lastName: user.lastName,\r\n    id: user.id,\r\n    accessTokenExpires:\r\n      Date.now() + parseInt(process.env.TOKEN_REFRESH_PERIOD) * 1000,\r\n  };\r\n  // return jwt\r\n  const refreshToken = jwt.sign(payload, process.env.JWT_SECRET_KEY, {\r\n    expiresIn: parseInt(process.env.TOKEN_MAX_AGE),\r\n    algorithm: \"HS512\",\r\n  });\r\n\r\n  return refreshToken;\r\n};\r\n\r\n// export const setCookie = (user: UserType, res: Response): void => {\r\n//   const payload: JWTPayload = {\r\n//     email: user.email,\r\n//     firstName: user.firstName,\r\n//     lastName: user.lastName,\r\n//     id: user.id,\r\n//   };\r\n//   // return jwt\r\n//   const token = jwt.sign(payload, process.env.JWT_SECRET_KEY);\r\n//   res.setHeader(\"Set-Cookie\", cookie.serialize(\"theinntoken\", token), {\r\n//     httpOnly: true,\r\n//     maxAge: 6 * 60 * 60,\r\n//     path: \"/\",\r\n//     sameSite: \"lax\",\r\n//     secure: process.env.NODE_ENV === \"production\",\r\n//   });\r\n// };\r\n"],"names":["setToken","user","res","payload","email","id","firstName","lastName","accessTokenExpires","Date","now","parseInt","process","env","TOKEN_REFRESH_PERIOD","token","jwt","sign","JWT_SECRET_KEY","console","log","cookie","httpOnly","createToken","createRefreshToken","refreshToken","expiresIn","TOKEN_MAX_AGE","algorithm"],"mappings":"AAAA;;;;;AAGgB,IAAA,aAAc,kCAAd,cAAc,EAAA;;;;;;AAUvB,MAAMA,QAAQ,GAAG,CAACC,IAAc,EAAEC,GAAa,GAAW;IAC/D,MAAMC,OAAO,GAAe;QAC1BC,KAAK,EAAEH,IAAI,CAACG,KAAK;QACjBC,EAAE,EAAEJ,IAAI,CAACI,EAAE;QACXC,SAAS,EAAEL,IAAI,CAACK,SAAS;QACzBC,QAAQ,EAAEN,IAAI,CAACM,QAAQ;QACvBC,kBAAkB,EAChBC,IAAI,CAACC,GAAG,EAAE,GAAGC,QAAQ,CAACC,OAAO,CAACC,GAAG,CAACC,oBAAoB,CAAC,GAAG,IAAI;KACjE,AAAC;IAEF,MAAMC,KAAK,GAAGC,aAAG,QAAA,CAACC,IAAI,CAACd,OAAO,EAAES,OAAO,CAACC,GAAG,CAACK,cAAc,CAAC,AAAC;IAE5DC,OAAO,CAACC,GAAG,CAAC,SAAS,EAAEL,KAAK,CAAC,CAAC;IAE9Bb,GAAG,CAACmB,MAAM,CAAC,KAAK,EAAEN,KAAK,EAAE;QACvBO,QAAQ,EAAE,IAAI;KACf,CAAC,CAAC;CACJ,AAAC;QAjBWtB,QAAQ,GAARA,QAAQ;AAmBd,MAAMuB,WAAW,GAAG,CAACtB,IAAc,GAAa;IACrD,MAAME,OAAO,GAAe;QAC1BC,KAAK,EAAEH,IAAI,CAACG,KAAK;QACjBE,SAAS,EAAEL,IAAI,CAACK,SAAS;QACzBC,QAAQ,EAAEN,IAAI,CAACM,QAAQ;QACvBF,EAAE,EAAEJ,IAAI,CAACI,EAAE;QACXG,kBAAkB,EAChBC,IAAI,CAACC,GAAG,EAAE,GAAGC,QAAQ,CAACC,OAAO,CAACC,GAAG,CAACC,oBAAoB,CAAC,GAAG,IAAI;KACjE,AAAC;IAEF,MAAMC,KAAK,GAAGC,aAAG,QAAA,CAACC,IAAI,CAACd,OAAO,EAAES,OAAO,CAACC,GAAG,CAACK,cAAc,CAAC,AAAC;IAE5D,OAAOH,KAAK,CAAC;CACd,AAAC;QAbWQ,WAAW,GAAXA,WAAW;AAejB,MAAMC,kBAAkB,GAAG,CAACvB,IAAc,GAAK;IACpD,MAAME,OAAO,GAAe;QAC1BC,KAAK,EAAEH,IAAI,CAACG,KAAK;QACjBE,SAAS,EAAEL,IAAI,CAACK,SAAS;QACzBC,QAAQ,EAAEN,IAAI,CAACM,QAAQ;QACvBF,EAAE,EAAEJ,IAAI,CAACI,EAAE;QACXG,kBAAkB,EAChBC,IAAI,CAACC,GAAG,EAAE,GAAGC,QAAQ,CAACC,OAAO,CAACC,GAAG,CAACC,oBAAoB,CAAC,GAAG,IAAI;KACjE,AAAC;IAEF,MAAMW,YAAY,GAAGT,aAAG,QAAA,CAACC,IAAI,CAACd,OAAO,EAAES,OAAO,CAACC,GAAG,CAACK,cAAc,EAAE;QACjEQ,SAAS,EAAEf,QAAQ,CAACC,OAAO,CAACC,GAAG,CAACc,aAAa,CAAC;QAC9CC,SAAS,EAAE,OAAO;KACnB,CAAC,AAAC;IAEH,OAAOH,YAAY,CAAC;CACrB,AAAC;QAhBWD,kBAAkB,GAAlBA,kBAAkB"}