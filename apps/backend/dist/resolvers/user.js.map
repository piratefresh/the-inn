{"version":3,"sources":["../../src/resolvers/user.ts"],"sourcesContent":["import {\r\n  Arg,\r\n  Ctx,\r\n  Field,\r\n  InputType,\r\n  Mutation,\r\n  Query,\r\n  Resolver,\r\n} from \"type-graphql\";\r\nimport argon2 from \"argon2\";\r\nimport { User } from \"@models/User\";\r\nimport { MyContext } from \"@typedefs/MyContext\";\r\nimport jwt from \"jsonwebtoken\";\r\n\r\n@InputType()\r\nexport class UsernamePasswordInput {\r\n  @Field()\r\n  username: string;\r\n  @Field()\r\n  firstName: string;\r\n  @Field()\r\n  lastName: string;\r\n  @Field()\r\n  password: string;\r\n  @Field()\r\n  email: string;\r\n}\r\n\r\n@Resolver()\r\nexport class UserResolver {\r\n  @Query(() => String)\r\n  async helloworld() {\r\n    return \"hello world\";\r\n  }\r\n  @Query(() => [User])\r\n  async getUsers(@Ctx() { prisma, res }: MyContext) {\r\n    return prisma.user.findMany({});\r\n  }\r\n  @Query(() => [User])\r\n  async getUser(@Ctx() { prisma, res }: MyContext) {\r\n    return prisma.user.findFirst({});\r\n  }\r\n\r\n  @Mutation((_type) => User)\r\n  async signup(\r\n    @Arg(\"options\") options: UsernamePasswordInput,\r\n    @Ctx() { prisma, res }: MyContext\r\n  ) {\r\n    const hashedPassword = await argon2.hash(options.password);\r\n    const user = await prisma.user.create({\r\n      data: {\r\n        ...options,\r\n        experience: \"Beginner\",\r\n        password: hashedPassword,\r\n      },\r\n    });\r\n\r\n    const token = jwt.sign({ userId: user.id }, \"keyboard cat\");\r\n\r\n    res.cookie(\"token\", token, {\r\n      httpOnly: false,\r\n      // secure: false,\r\n      maxAge: 1000 * 60 * 60 * 24 * 365, // 1 year cookie\r\n    });\r\n    return {\r\n      token,\r\n      user,\r\n    };\r\n  }\r\n}\r\n"],"names":["UsernamePasswordInput","Field","username","firstName","lastName","password","email","InputType","UserResolver","helloworld","getUsers","prisma","res","user","findMany","getUser","findFirst","signup","options","hashedPassword","argon2","hash","create","data","experience","token","jwt","sign","userId","id","cookie","httpOnly","maxAge","Query","String","User","Ctx","Mutation","_type","Arg","Resolver"],"mappings":"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"}