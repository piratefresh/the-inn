{"version":3,"sources":["../../src/resolvers/user.ts"],"sourcesContent":["import {\r\n  Arg,\r\n  Ctx,\r\n  Field,\r\n  InputType,\r\n  Mutation,\r\n  Query,\r\n  Resolver,\r\n} from \"type-graphql\";\r\nimport argon2 from \"argon2\";\r\nimport { User } from \"@models/User\";\r\nimport { MyContext } from \"@typedefs/MyContext\";\r\nimport jwt from \"jsonwebtoken\";\r\n\r\n@InputType()\r\nexport class UsernamePasswordInput {\r\n  @Field()\r\n  firstName: string;\r\n  @Field()\r\n  lastName: string;\r\n  @Field()\r\n  password: string;\r\n  @Field()\r\n  email: string;\r\n}\r\n\r\n@Resolver()\r\nexport class UserResolver {\r\n  @Query(() => String)\r\n  async helloworld() {\r\n    return \"hello world\";\r\n  }\r\n  @Query(() => [User])\r\n  async getUsers(@Ctx() { prisma, res }: MyContext) {\r\n    return prisma.user.findMany({});\r\n  }\r\n  @Query(() => [User])\r\n  async getUser(@Ctx() { prisma, res }: MyContext) {\r\n    return prisma.user.findFirst({});\r\n  }\r\n\r\n  @Mutation((_type) => User)\r\n  async signup(\r\n    @Arg(\"options\") options: UsernamePasswordInput,\r\n    @Ctx() { prisma, res }: MyContext\r\n  ) {\r\n    const hashedPassword = await argon2.hash(options.password);\r\n    const createdUser = await prisma.user.create({\r\n      data: {\r\n        ...options,\r\n        experience: \"Beginner\",\r\n        password: hashedPassword,\r\n      },\r\n    });\r\n\r\n    await prisma.account.create({\r\n      data: {\r\n        userId: createdUser.id,\r\n        type: \"credentials\",\r\n        provider: \"Credentials\",\r\n        providerAccountId: createdUser.id,\r\n      },\r\n    });\r\n\r\n    const token = jwt.sign({ userId: createdUser.id }, \"keyboard cat\");\r\n\r\n    res.cookie(\"token\", token, {\r\n      httpOnly: false,\r\n      // secure: false,\r\n      maxAge: 1000 * 60 * 60 * 24 * 365, // 1 year cookie\r\n    });\r\n    return {\r\n      token,\r\n      ...createdUser,\r\n    };\r\n  }\r\n}\r\n"],"names":["UsernamePasswordInput","Field","firstName","lastName","password","email","InputType","UserResolver","helloworld","getUsers","prisma","res","user","findMany","getUser","findFirst","signup","options","hashedPassword","argon2","hash","createdUser","create","data","experience","account","userId","id","type","provider","providerAccountId","token","jwt","sign","cookie","httpOnly","maxAge","Query","String","User","Ctx","Mutation","_type","Arg","Resolver"],"mappings":"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"}